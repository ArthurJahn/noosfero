#!/bin/sh

set -e

export RAILS_ENV=development

stop() {
  ./script/delayed_job stop
  ./script/feed-updater stop
  whenever --clear-crontab
  exit
}

start() {
  rake db:abort_if_pending_migrations
  ./script/feed-updater start
  ./script/delayed_job start
  trap stop INT TERM
  whenever --write-crontab --set 'environment=development'
  rails s $@
}

start $@
