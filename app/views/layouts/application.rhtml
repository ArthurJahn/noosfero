<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>
      <%= @environment.name() %>
      <%- if @category -%>
        &rarr; <%= @category.full_name -%>
      <%- end -%>
    </title>
    <meta name="description" content="FIXME: Descriptions of Noosfero" />
    <meta name="keywords" content="Noosfero, Community, Open Source" />
    <%#
     stylesheet_import is better then stylesheet_link_tag because the stylesheet
     must be loaded before the page show.
    %>
    <%=
      # Load the principal css files:
      stylesheet_import( %w( common help menu article button search blocks forms login-box )
                         ) + "\n" +
      stylesheet_import( %w( common help menu article button search blocks forms login-box ),
                         :themed_source => true ) + "\n" +
      # Load the boxes's css file if each exists:
      import_blocks_stylesheets +
      # Load the controller's css file if it exists:
      stylesheet_import( "controller_"+ @controller.controller_name() ) + "\n" +
      stylesheet_import( "controller_"+ @controller.controller_name(), :themed_source => true )
    %>

    <%# FIXME: for unknow reason the @import url(.../article.css) above dont work for class .post_comment_box.opened/closed %>
    <%= stylesheet_link_tag 'article' %>

    <%# FIXME %>
    <%= stylesheet_link_tag '/designs/templates/default/stylesheets/style.css' %>
    <%= stylesheet_link_tag '/designs/icons/default/style.css' %>

    <%= javascript_include_tag(:defaults) %>
    <%# javascript_include_tag 'animator' %>
    <%= javascript_include_tag 'menu' %>
    <%= javascript_include_tag 'auto-open-menu' %>
    <%= include_lightbox_header %>
    <%# cms stuff %>
    <% if params[:controller] == 'cms' %>
      <%= javascript_include_tag 'cms' %>
    <% end %>
  </head>

  <body class='noosfero category<%= category_color %><%=
    # Identify the current controller and action for the CSS:
    " controller_"+ @controller.controller_name() +
    " action_"+ @controller.controller_name() +"_"+ @controller.action_name()
    %>' onload='noosfero_init();'
    help=<%= _('Pass the mouse over page elements to get help on them. Click the question mark icon on the top-right corner to deactivate this help window.').inspect %> >
    <script type="text/javascript">
      /* Adds a class to "msie" to the body element if a Microsoft browser is
       * detected. This is needed to workaround several of their limitations.
       */
      if ( navigator.appVersion.indexOf("MSIE") > -1 ) {
        document.body.className += " msie msie" +
          navigator.appVersion.replace(/^.*MSIE\s+([0-9]+).*$/, "$1");
      }
    </script>

    <% unless flash[:notice].nil? %>
      <div id="notice" onclick="Element.hide('notice');" style="display:none">
        <%= flash[:notice] %>
        <%= javascript_tag(
          visual_effect( :appear,    'notice', :duration => 2, :queue => :end ) +
          visual_effect( :highlight, 'notice', :duration => 3, :queue => :end ) +
          visual_effect( :fade,      'notice', :duration => 2, :queue => :end )
        ) %>
      </div>
    <% end %>

    <div id="accessibility_menu">
      <a href="#content" id="link_go_content"><span><%= _('Go to content') %></span></a>
    </div><!-- accessibility_menu -->

    <div id="path_category">
      <% if @category -%>
        <%= @category.full_name(" &rarr; ") %>
      <% end -%>
      <%= javascript_tag(visual_effect(:fade, "path_category", :duration => 10)) %>
    </div>

    <div id="wrap">

      <div id="beta-tag"><span>BETA</span></div>

      <div id="noosfero_bar" help="#noosfero_bar_help">
        <div id="noosfero_bar_help" style="display:none">
        <%= _("This is %s's shortcuts bar. Using it you have access to the main features of the environment and you find the information of your interest more quickly.") % @environment.name %>
        <p/>
        <%= _("This bar helps you find information following two paths or <strong>dimensions</strong>. First dimension is composed of <em>categories</em>, which you'll find in the colored tabs in the top. Second dimension has <em>content types</em>, and you'll find them in the animated bar on your right.") % @environment.name %>
        </div>

        <div id='navigation_bar'>
          <%= render :file => 'shared/categories_menu' %>
        </div><!-- id='navigation_bar' -->
        <script type="text/javascript">
          prepareMenu('navigation_bar', { timeout: 1000 });
        </script>

        <div id='user_box'>
          <%= render :file => 'shared/user_menu' %>
          <%=
          lightbox_link_to '<span class="icon-menu-search"></span>'+ _('Search'),
          { :controller => 'search', :action => 'popup', :category_path => (@category ? @category.explode_path : []) }, :id => 'open_search'
          %>
        </div><!-- id='user_box' -->

        <a href="#" id="btShowHelp" class="icon-help32on"
           title="<%= _('Turn help on/off') %>"
           onclick="mouseHelpOnOff()"><span><%= _('Help') %></span></a>

      </div><!-- id="noosfero_bar" -->

      <div id='frame'><!-- Frame que envolve toda pagina de um usuario -->
        <div id='header'>
          <!-- Abaixo um cabeÃ§alho especifico para a pagina de usuario. -->
        </div><!-- id='header' -->
        <div id='content'>
          <div id='header_content'>
          </div>

          <% if @controller.send(:boxes_editor?) %>
            <%= yield %>
            <%= display_boxes_editor(@controller.boxes_holder) %>
          <% else %>
            <% if uses_design_blocks?  %>
              <%= display_boxes(@controller.boxes_holder, yield) %>
            <% else %>
              <%= yield %>
            <% end %>
          <% end %>

        </div><!-- id="content" -->
        <div id="footer_content"><!-- Rodape do onteudo -->
        </div><!-- id="footer_content" -->
      </div><!-- id="frame" -->
    </div><!-- id="wrap" -->

    <div id="footer">
      <%= language_chooser %>

      <!-- <a name='footer'/></a> -->
      <%= footer %>
    </div><!-- id="footer" -->

    <div id="helpBox" style="display:none">
      <div id="helpBoxBody">
        <div class="helpAvatar"></div>
        <div id="helpBoxContent"></div>
      </div>
    </div>
    <%= javascript_include_tag 'show-mouse-help' %>
    <div id="noticeAboutHelp" style="display:none">
      <div class="helpAvatar"></div>
      <%= _('Do you want to activate the automatic help mode?') %>
      <div class="bts">
      <a href="javascript:mouseHelpOn()"  class="button with-text icon-ok">
        <span><%= _('Yes') %></span></a>
      &nbsp;
      <a href="javascript:mouseHelpOff()" class="button with-text icon-cancel">
        <span><%= _('No') %></span></a>
      </div><!-- end class="bts" -->
      <p/>
      <%= _('If needed, you can activate or deactivate the automatic help mode by clicking the question mark symbol in the top-right corner') %>
    </div>
    <%= javascript_include_tag 'noosfero-show-help' %>

    <%# javascript_tag('noosferoHelpInit(%s, %s)' % [ _('Do you want to activate the automatic help mode?').inspect, _('If needed, you can activate the automatic help mode by clicking the question mark symbol in the top-right corner').inspect ])  %>

    <div id="better-browser-promotion" style="display:none">
      <h3><%=
      _('Your web browser is obsolete!') +'</h3><p/>'+
      _('This website will not look as good as it could.
         Don\'t you want to use Firefox? That is a great web browser, free,
         and made by people of all the world parts.')
      %><p/>
      <b id="bbp-getff"><a href="http://getfirefox.com" class="icon-firefox" target="getff"><%= _('Get Firefox Now!') %></a></b>
    </div>
    <%= javascript_include_tag 'better-browser-promotion' %>

    <script type="text/javascript">
      // the onload will run only after all related documents load.
      // by that we need to cal this here:
      if ( window.addEventListener ) resizePrincipalTemplateBox()
    </script>

  </body>
</html>
