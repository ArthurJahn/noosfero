<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>
      <%= @environment.name() %>
      <%- if @category -%>
        &rarr; <%= @category.full_name -%>
      <%- end -%>
    </title>
    <meta name="description" content="FIXME: Descriptions of Noosfero" />
    <meta name="keywords" content="Noosfero, Community, Open Source" />
    <%#
     stylesheet_import is better then stylesheet_link_tag because the stylesheet
     must be loaded before the page show.
    %>
    <%= stylesheet_import %w( common help menu button search blocks forms login-box ) %>
    <%= import_blocks_stylesheets %>
    <%=
      # Load the controller's css file if it exists:
      css = "controller_"+ @controller.controller_name() +".css"
      stylesheet_link_tag( css ) if File.exists?( "public/stylesheets/"+css )
    %>

    <%# FIXME %>
    <%= stylesheet_link_tag '/designs/templates/default/stylesheets/style.css' %>
    <%= stylesheet_link_tag '/designs/icons/default/style.css' %>

    <%= javascript_include_tag(:defaults) %>
    <%= javascript_include_tag 'menu' %>
    <%= javascript_include_tag 'auto-open-menu' %>
    <%= include_lightbox_header %>
    <%# cms stuff %>
    <% if params[:controller] == 'cms' %>
      <%= javascript_include_tag 'cms' %>
    <% end %>
  </head>

  <body class='noosfero category<%= category_color %><%=
    # Identify the current controller and action for the CSS:
    " controller_"+ @controller.controller_name() +
    " action_"+ @controller.controller_name() +"_"+ @controller.action_name()
    %>' onload='noosfero_init();'>
    <script type="text/javascript">
      /* Adds a class to "msie" to the body element if a Microsoft browser is
       * detected. This is needed to workaround several of their limitations.
       */
      if ( navigator.appName.indexOf("Microsoft") > -1 ) {
        document.body.className += " msie";
      }
    </script>

    <% unless flash[:notice].nil? %>
      <div id='notice' onclick="Element.hide('notice');">
        <%= flash[:notice] %>
        <%= javascript_tag(visual_effect(:fade, "notice", :duration => 15)) %>
      </div>
    <% end %>

    <div id='accessibility_menu'>
      <a href='#content' id='link_go_content'><span><%= _('Go to content') %></span></a>
    </div><!-- accessibility_menu -->

    <div id='path_category'>
      <% if @category -%>
        <%= @category.full_name(" &rarr; ") %>
      <% end -%>
      <%= javascript_tag(visual_effect(:fade, "path_category", :duration => 10)) %>
    </div>

    <div id="wrap">

      <div id="beta-tag"><span>BETA</span></div>

      <div id='noosfero_bar' style='position: absolute;'>

        <div id='navigation_bar'>
          <%= render :file => 'shared/categories_menu' %>
        </div><!-- id='navigation_bar' -->
        <script type="text/javascript">
          prepareMenu('navigation_bar', { timeout: 1000 });
        </script>

        <div id='user_box'>
          <%= render :file => 'shared/user_menu' %>
          <%=
          lightbox_link_to '<span class="icon-menu-search"></span>'+ _('Search'),
                           { :controller => 'search', :action => 'popup' }, :id => 'open_search'
          %>
        </div><!-- id='user_box' -->

      </div><!-- id="noosfero_bar" -->

      <div id='frame'><!-- Frame que envolve toda pagina de um usuario -->
        <div id='header'>
          <!-- Abaixo um cabeÃ§alho especifico para a pagina de usuario. -->
        </div><!-- id='header' -->
        <div id='content'>
          <!-- <a name='main_content'/></a> -->
          <div id='header_content'>
          </div>

          <% if @controller.send(:boxes_editor?) %>
            <%= yield %>
            <%= display_boxes_editor(@controller.boxes_holder) %>
          <% else %>
            <% if uses_design_blocks?  %>
              <%= display_boxes(@controller.boxes_holder, yield) %>
            <% else %>
              <%= yield %>
            <% end %>
          <% end %>

        </div><!-- id="content" -->
        <div id="footer_content"><!-- Rodape do onteudo -->
        </div><!-- id="footer_content" -->
      </div><!-- id="frame" -->
    </div><!-- id="wrap" -->

    <div id="footer">
      <!-- <a name='footer'/></a> -->
      <%= localist_menu %>
      <%= footer %>
    </div><!-- id="footer" -->
  </body>
</html>
